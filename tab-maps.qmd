```{python}
#| echo: false  # hides python code
import numpy as np
import pandas as pd
import plotly.express as px

df = pd.read_csv("assets/data/participants_until_2025.csv")
counts = (
    df["country"]
    .astype(str)
    .str.strip()
    .value_counts()
    .reset_index()
)
counts.columns = ["country", "count"]
counts["count_log"] = np.log10(counts["count"] + 1)

iso3_map = {
    "Algeria": "DZA",
    "Argentina": "ARG",
    "Austria": "AUT",
    "Belgium": "BEL",
    "Brazil": "BRA",
    "Bulgaria": "BGR",
    "Canada": "CAN",
    "Chad": "TCD",
    "Chile": "CHL",
    "China": "CHN",
    "Croatia": "HRV",
    "Cuba": "CUB",
    "Cyprus": "CYP",
    "Czechia": "CZE",
    "Egypt": "EGY",
    "Estonia": "EST",
    "Finland": "FIN",
    "France": "FRA",
    "Germany": "DEU",
    "Ghana": "GHA",
    "Greece": "GRC",
    "Hungary": "HUN",
    "India": "IND",
    "Iran": "IRN",
    "Ireland": "IRL",
    "Israel": "ISR",
    "Italy": "ITA",
    "Japan": "JPN",
    "Jordan": "JOR",
    "Kazakhstan": "KAZ",
    "Letonia": "LVA",
    "Mexico": "MEX",
    "Morocco": "MAR",
    "Nepal": "NPL",
    "Netherlands": "NLD",
    "NewZealand": "NZL",
    "Norway": "NOR",
    "Oman": "OMN",
    "Palestine": "PSE",
    "Poland": "POL",
    "Portugal": "PRT",
    "Romania": "ROU",
    "Russia": "RUS",
    "Serbia": "SRB",
    "Slovakia": "SVK",
    "Slovenia": "SVN",
    "SouthAfrica": "ZAF",
    "Spain": "ESP",
    "Sweden": "SWE",
    "Switzerland": "CHE",
    "Syria": "SYR",
    "Tunisia": "TUN",
    "Turkey": "TUR",
    "UAE": "ARE",
    "UK": "GBR",
    "USA": "USA",
    "Uganda": "UGA",
    "Uzbekistan": "UZB",
}

counts["iso3"] = counts["country"].map(iso3_map)
missing = counts.loc[counts["iso3"].isna(), "country"].tolist()
if missing:
    raise ValueError(
        "Missing ISO-3 mapping for: " + ", ".join(sorted(set(missing)))
    )

fig = px.choropleth(
    counts,
    locations="iso3",
    color="count_log",
    color_continuous_scale=[
        "#0d1a2b",
        "#204a87",
        "#2f6ea7",
        "#4a91b3",
        "#76b59f",
        "#b7d77d",
        "#f0f9a8",
    ],
    hover_name="country",
    hover_data={"count": True, "count_log": False, "iso3": False},
    projection="orthographic",
)
fig.update_layout(
    margin=dict(l=0, r=0, t=0, b=0),
    paper_bgcolor="rgba(0,0,0,0)",
    plot_bgcolor="rgba(0,0,0,0)",
    coloraxis_colorbar=dict(
        title=dict(text="Applicants<br>[log10]", font=dict(color="rgba(255,255,255,0.9)")),
        ticklabelposition="outside",
        tickfont=dict(color="rgba(255,255,255,0.9)"),
        ticklen=6,
        ticks="outside",
        tickwidth=1,
    ),
)
fig.update_geos(
    showframe=False,
    showcoastlines=True,
    showcountries=True,
    countrycolor="rgba(255,255,255,0.9)",
    projection_rotation=dict(lon=0, lat=0),
    bgcolor="rgba(0,0,0,0)",
)
fig
```
